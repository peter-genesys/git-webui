<h2>RepoList</h2>

<p>Current Repo : <input data-bind="value: currentRepo" /></p>
<table>
    <thead><tr>
        <th>Repo Name</th><th>Path</th><th>Branch</th><th></th>
    </tr></thead>
    <tbody data-bind="foreach: repos">
        <tr>
            <td data-bind="text: name"></td>
            <td data-bind="text: path"></td>
            <td data-bind="text: branch"></td>
        </tr>    
    </tbody>

</table>
<button onclick="alert('click');" id="repolist-refresh" class="ui-button ui-widget ui-corner-all">Refresh</button>
<button onclick="do_click();" id="repolist-refresh2" class="ui-button ui-widget ui-corner-all">Refresh2</button>
<button id="repolist-refresh3" class="ui-button ui-widget ui-corner-all">Refresh3</button>
<button data-bind="click: test" class="ui-button ui-widget ui-corner-all">Test</button>
<button data-bind="click: refreshRepoList" class="ui-button ui-widget ui-corner-all">Refresh</button>

<div><p id="post-result">Hey</p></div>

<pre data-bind="text: rawData"></pre> 
 
<script>

$$( "div" ).hide();

//REPO_LIST
// Class to represent a repo
function Repo(name, path, branch) {
    var self = this;
    self.name = name;
    self.path = path;
    self.branch = branch;
}

// Overall viewmodel for this screen, along with initial state
function ReposViewModel() {
    var self = this;
    
    self.currentRepo = ko.observable("Repo1");
    
    self.rawData = ko.observable("{}");
 
    // Editable data
    self.repos = ko.observableArray([
        new Repo("Repo1", "Repo1path", "master")
       ,new Repo("Repo2", "Repo2path", "master")
       ,new Repo("Repo3", "Repo3path", "master")
    ]);
    
    self.test = function() {
        self.currentRepo("test")
    }; 
    
    self.refreshRepoList = function() {

        self.rawData("Pressed");
        //var requestObj = gitpatcher.refreshRepoList();
        //var request = JSON.stringify(requestObj);
        //self.rawData(request);
        
        //self.rawData(gitpatcher.refreshRepoList());
        
        //self.rawData('{"greeting" : "hi"}');
        //self.rawData({"greeting" : "hi"});
        
        //self.currentRepo("test");
        self.repos([
          new Repo("Repo4", "Repo1path", "master")
         ,new Repo("Repo5", "Repo2path", "master")
         ,new Repo("Repo6", "Repo3path", "master")
        ]);
        
        
        $$.post("/repolist", function(data, status){
           var response = JSON.stringify(data);    
           var stat = JSON.stringify(status);
            
           alert("Data: " + response + "\nStatus: " + stat);
           
           self.rawData(response);
           
        });
     
    }    
}

//ko.applyBindings(new ReposViewModel());


function SomeViewModel() {
    var self = this;
 
    self.currentRepo = ko.observable("Repo1");
    
    self.rawData = ko.observable("{}");
 
    self.repos = ko.mapping.fromJS([]);
    
    self.test = function() {
        self.currentRepo("test")
    }; 
 /*
    this.refreshRepoList = function() {
        $$.ajax({
            type: 'POST',
            url: '/repolist',
            data: JSON.stringify([
          new Repo("Repo4", "Repo1path", "master")
         ,new Repo("Repo5", "Repo2path", "master")
         ,new Repo("Repo6", "Repo3path", "master")
        ]),
            context: this,
            success: function(data) {
                self.SuccessfullyRetrievedModelsFromAjax(data);
            },
            dataType: 'json'
        });
    };
*/
    self.refreshRepoList = function() {

        self.rawData("Pressed");
  
        $$.post("/repolist", function(data, status){
           var response = JSON.stringify(data);    
           var stat = JSON.stringify(status);
            
           alert("Data: " + response + "\nStatus: " + stat);
           
           self.rawData(response);
           self.mapToRepos(data)
           
        });
     
    }    
    
    this.mapToRepos = function(repos) {
        ko.mapping.fromJS(repos, self.repos);
    };

    //this.SuccessfullyRetrievedModelsFromAjax = function(repos) {
    //    ko.mapping.fromJSON(repos, self.repos);
    //};
   /*
    this.mapResponseToRepos = function(repos) {
        ko.mapping.fromJS([{
                name: "Repo4",
                path: "Repo4path",
                branch: "master"
                }], self.repos);
    };
    */
    
    
    
}

ko.applyBindings(new SomeViewModel());

 

function do_click(){
    alert("repolist-refresh2 was clicked.");
    
    //ReposViewModel.repos()[1].name("Fred");
    
 
    //$("#post-result").text('Pushed');
    //gitpatcher.refreshRepoList();
}

$$(function(){
    // DOM Ready - do your stuff 
    $$("#repolist-refresh3").click(function(){
        alert("The repolist-refresh3 was clicked.");
    });
}); 

 
</script>


<h2>RepoList</h2>

<p>GitRepos Path: <input data-bind="value: GitReposPath" /></p>
<p>Current Repo : <input data-bind="value: currentRepo" /></p>
<table>
    <thead><tr>
        <th>Repo Name</th><th>Path</th><th>Branch</th><th></th>
    </tr></thead>
    <tbody data-bind="foreach: repos">
        <tr>
            <td data-bind="text: name"></td>
            <td data-bind="text: path"></td>
            <td data-bind="text: branch"></td>
        </tr>    
    </tbody>

</table>
<button onclick="alert('click');" id="repolist-refresh" class="ui-button ui-widget ui-corner-all">Refresh</button>
<button onclick="do_click();" id="repolist-refresh2" class="ui-button ui-widget ui-corner-all">Refresh2</button>
<button id="repolist-refresh3" class="ui-button ui-widget ui-corner-all">Refresh3</button>
<button data-bind="click: test" class="ui-button ui-widget ui-corner-all">Test</button>
<button data-bind="click: refreshRepoList" class="ui-button ui-widget ui-corner-all">Refresh</button>

<div><p id="post-result">Hey</p></div>

<pre data-bind="text: rawData"></pre> 
 
<script>

$$( "div" ).hide();

//REPO_LIST
// Class to represent a repo
function Repo(name, path, branch) {
    var self = this;
    self.name = name;
    self.path = path;
    self.branch = branch;
}

function Path(path) {
    var self = this;
    self.path = path;
}

// Overall viewmodel for this screen, along with initial state
function ReposViewModel() {
    var self = this;
    
    self.currentRepo = ko.observable("Repo1");
    
    self.rawData = ko.observable("{}");
 
    // Editable data
    self.repos = ko.observableArray([
        new Repo("Repo1", "Repo1path", "master")
       ,new Repo("Repo2", "Repo2path", "master")
       ,new Repo("Repo3", "Repo3path", "master")
    ]);
    
    self.test = function() {
        self.currentRepo("test")
    }; 
    
    self.refreshRepoList = function() {

        self.rawData("Pressed");
 
        self.repos([
          new Repo("Repo4", "Repo1path", "master")
         ,new Repo("Repo5", "Repo2path", "master")
         ,new Repo("Repo6", "Repo3path", "master")
        ]);
        
        
        $$.post("/repolist", function(data, status){
           var response = JSON.stringify(data);    
           var stat = JSON.stringify(status);
            
           alert("Data: " + response + "\nStatus: " + stat);
           
           self.rawData(response);
           
        });
     
    }    
}

//ko.applyBindings(new ReposViewModel());


function SomeViewModel() {
    var self = this;
 
    self.currentRepo = ko.observable("Repo1");
    
    self.GitReposPath = ko.observable("/home/ubuntu/GitRepos");
 
    self.rawData = ko.observable("{}");
 
    self.repos = ko.mapping.fromJS([]);
    
    self.test = function() {
        self.currentRepo("test")
    }; 
 
    self.refreshRepoList = function() {

        self.rawData("Pressed");
        alert(self.GitReposPath());
 
        var requestObj =  new Path(self.GitReposPath())
 
        var request = JSON.stringify(requestObj);
        console.log(request);
  
        $$.post("/repolist", request, function(data, status){
           var response = JSON.stringify(data);    
           var stat = JSON.stringify(status);
            
           alert("Data: " + response + "\nStatus: " + stat);
           
           console.log(response);
           console.log(stat);
           
           self.rawData(response);
           self.mapToRepos(data)
           
        });
     
    }    
    
    this.mapToRepos = function(repos) {
        ko.mapping.fromJS(repos, self.repos);
    };
   
}

ko.applyBindings(new SomeViewModel());

 

function do_click(){
    alert("repolist-refresh2 was clicked.");
 
}

$$(function(){
    // DOM Ready - do your stuff 
    $$("#repolist-refresh3").click(function(){
        $$("<div>refresh3</div>").dialog();
        alert("The repolist-refresh3 was clicked.");
    });
}); 

 
</script>


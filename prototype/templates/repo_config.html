<h2>RepoConfig</h2>

<p>GitRepos Config file Path: <input data-bind="value: GitReposConfigPath" /></p>


<button data-bind="click: refreshRepoConfig" class="ui-button ui-widget ui-corner-all">Refresh Config</button>

<pre data-bind="text: rawData">dummy</pre> 


<table>
    <thead><tr>
        <th>Repo Name</th><th>Path</th>
    </tr></thead>
    <tbody data-bind="foreach: repos">
        <tr>
            <td data-bind="text: _RepoName"></td>
            <td data-bind="text: _RepoPath"></td>
        </tr>    
    </tbody>

</table>

<div id="accordion" data-bind="foreach: repos">
  <div class="group">    
    <h3 data-bind="text: _RepoName"></h3>
    <div>
      <p data-bind="text: _RepoPath"></p>
    </div>
  </div>  
</div>

 
<script>



function json2html(json) {
    var i, ret = "";
    ret += "<ul>";
    for( i in json) {
        ret += "<li>"+i+": ";
        if( typeof json[i] === "object") ret += json2html(json[i]);
        else ret += json[i];
        ret += "</li>";
    }
    ret += "</ul>";
    return ret;
}

function Path(path) {
    var self = this;
    self.path = path;
}

function RepoConfigViewModel() {
    var self = this;
 
 
    self.GitReposConfigPath = ko.observable("data/GitRepos.json");
 
    self.rawData = ko.observable("{}");
 
    self.repos = ko.mapping.fromJS([{"_RepoName":"NavigoAlesco",
                                     "_RepoPath":"F:/navigo_alesco/"}
                                    ,{"_RepoName":"stuff",
                                     "_RepoPath":"F:/navigo_alesco/"}]);
    
    self.htmlTree = ko.observable("<pre>DEMO</pre>");
  
 
    self.refreshRepoConfig = function() {

        self.rawData("Pressed");
        //alert(self.GitReposConfigPath());
 
        var requestObj =  new Path(self.GitReposConfigPath())
 
        var request = JSON.stringify(requestObj);
        console.log(request);
  
        $$.post("/repoconfig", request, function(data, status){
           var response = JSON.stringify(data);    
           var stat = JSON.stringify(status);
            
           //alert("Data: " + response + "\nStatus: " + stat);
           

           self.rawData(response);
           self.mapToRepoConfig(data);
           
           //self.htmlTree(json2html(data));
           
        });
     
    }    
    
    this.mapToRepoConfig = function(repoData) {
        //ko.mapping.fromJS(repos, self.repoConfig);
        ko.mapping.fromJS(repoData.repos.repo, self.repos);
        $$( "#accordion" ).accordion( "refresh" );
    };
   
}

ko.applyBindings(new RepoConfigViewModel());

 
$$(function(){
    // DOM Ready - do your stuff 
    $$( "#accordion" )
      .accordion({
        header: "> div > h3"
      })
      .sortable({
        axis: "y",
        handle: "h3",
        stop: function( event, ui ) {
          // IE doesn't register the blur when sorting
          // so trigger focusout handlers to remove .ui-state-focus
          ui.item.children( "h3" ).triggerHandler( "focusout" );
 
          // Refresh accordion to handle new order
          $$( this ).accordion( "refresh" );
        }
      });

}); 

 
</script>

